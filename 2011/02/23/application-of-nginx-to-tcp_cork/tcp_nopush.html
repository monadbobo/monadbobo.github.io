<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>nginx对TCP_CORK/TCP_NOPUSH的使用 | pagefault</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">nginx对TCP_CORK/TCP_NOPUSH的使用</h1><a id="logo" href="/.">pagefault</a><p class="description">但行好事 莫問前程</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">nginx对TCP_CORK/TCP_NOPUSH的使用</h1><div class="post-meta">Feb 23, 2011<span> | </span><span class="category"><a href="/categories/nginx/">nginx</a><a href="/categories/nginx/server/">server</a></span></div><div class="post-content"><p>在nginx中使用了send_file 并且配合TCP_CORK/TCP_NOPUSH进行操作，我们一般的操作是这样子的，首先调用tcp_cork，阻塞下层的数据发送，然后调用send_file发送数据，最后关闭TCP_CORK/TCP_NOPUSH.而在nginx中不是这样处理的，前面两步都是一样的，最后一步，它巧妙的利用的http的特性，那就是基本都是短连接，也就是处理完当前的request之后，就会关闭当前的连接句柄，而在linux中，如果不是下面两种情况之一，那么关闭tcp句柄，就会发送完发送buf中的数据，才进行tcp的断开操作(具体可以看我以前写的那篇 “linux内核中tcp连接的断开处理”的 blog) :</p>
<p>1 接收buf中还有未读数据。</p>
<p>2 so_linger设置并且超时时间为0.</p>
<p>而如果调用shutdown来关闭写端的话，就是直接发送完写buf中的数据，然后发送fin。</p>
<p>ok，通过上面我们知道每次处理完请求，都会关闭连接(keepalive 会单独处理),而关闭连接就会帮我们将cork拔掉，所以这里就可以节省一个系统调用，从这里能看到nginx对细节的处理到了一个什么程度。</p>
<p>接下来还有一个单独要处理的就是keepalive的连接，由于keepalive是不会关闭当前的连接的，因此这里就必须显式的关闭tcp_cork。</p>
<a id="more"></a>
<p>然后我们来看代码，首先来看TCP_CORK/TCP_NOPUSH相关的配置，我们知道在nginx中 TCP_CORK/TCP_NOPUSH是默认关闭的，除非我们显示的打开(tcp_nopush on).而在nginx中对于TCP_CORK/TCP_NOPUSH选项的打开关闭是有两个位置，一个是ngx_http_core_loc_conf_t的tcp_nopush(这个对应配置文件里面的tcp_nopush选项),一个是r-&gt;connection-&gt;tcp_nopush，它默认是NGX_TCP_NOPUSH_UNSET，可是如果没有设置tcp_nopush on，则这个值就会被设为NGX_TCP_NOPUSH_DISABLED，也就是关闭tcp_cork.而这里主要使用的就是r-&gt;connection-&gt;tcp_nopush。这里多出来的NGX_TCP_NOPUSH_DISABLED主要就是针对keepalive的情况，后面我们会详细分析.</p>
<p>下面就是tcp_nopush的可选值.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">typedef enum &#123;</span><br><span class="line">       </span><br><span class="line">NGX_TCP_NOPUSH_UNSET = 0,</span><br><span class="line">       </span><br><span class="line">NGX_TCP_NOPUSH_SET,</span><br><span class="line">       </span><br><span class="line">NGX_TCP_NOPUSH_DISABLED</span><br><span class="line">  </span><br><span class="line">&#125; ngx_connection_tcp_nopush_e;</span><br></pre></td></tr></table></figure>
<p>来看core loc conf的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">      </span><br><span class="line">ngx_conf_merge_value(conf-&gt;tcp_nopush, prev-&gt;tcp_nopush, 0);</span><br></pre></td></tr></table></figure>
<p>可以看到他的默认值是0T，也就是tcp_nopush没有打开的情况。</p>
<p>然后是r-&gt;connection-&gt;tcp_nopush 的设置，它的值依赖于clcf-&gt;tcp_nopush，如果clcf-&gt;tcp_nopush为(默认值),则关闭tcp_nopush,否则就是默认值打开。而connection中的tcp_nopush默认是NGX_TCP_NOPUSH_UNSET，也就是0。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">      </span><br><span class="line">if (!clcf-&gt;tcp_nopush) &#123;</span><br><span class="line">          </span><br><span class="line">/\* disable TCP_NOPUSH/TCP_CORK use \*/</span><br><span class="line">  </span><br><span class="line">//设置关闭</span><br><span class="line">          </span><br><span class="line">r-&gt;connection-&gt;tcp_nopush = NGX_TCP_NOPUSH_DISABLED;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ok，接下来我们就直接来看nginx中如何使用TCP_CORK/TCP_NOPUSH,主要的代码是在ngx_linux_sendfile_chain（我们通过分析tcp_cork来分析，bsd的tcp_nopush和linux的处理类似)中，这个函数我前面的blog有详细分析过，这次主要是分析tcp_cork部分，我们主要来看,第一次调用sendfile的时候，会先设置tcp_cork.而设置之后就会设置c-&gt;tcp_nopush为NGX_TCP_NOPUSH_SET，也就是接下来的操作都不需要再次设置了。而最终当buf处理完毕，就直接返回。</p>
<p>这里有一个要注意的就是tcp_nodelay和tcp_nopush是互斥的。不过如果你同时设置了两个值的话，将会在第一个buf发送的时候，强制push数据，而第二个buf时，将会调用tcp_cork来打开nagle算法，也就是后面的都会应用tcp_nopush.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">//如果tcp_nopush为0(也就是配置文件中tcp_nopush on)，则进入tcp_nopush的处理。</span><br><span class="line">          </span><br><span class="line">if (c-&gt;tcp_nopush == NGX_TCP_NOPUSH_UNSET</span><br><span class="line">              </span><br><span class="line">&amp;&amp; header.nelts != 0</span><br><span class="line">              </span><br><span class="line">&amp;&amp; cl</span><br><span class="line">              </span><br><span class="line">&amp;&amp; cl-&gt;buf-&gt;in_file)</span><br><span class="line">          </span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;.</span><br><span class="line">  </span><br><span class="line">//如果nodelay有设置，则进入相关处理，也就是关闭nagle算法。</span><br><span class="line">                          </span><br><span class="line">if (c-&gt;tcp_nodelay == NGX_TCP_NODELAY_SET) &#123;</span><br><span class="line">                                                  </span><br><span class="line">tcp_nodelay = 0;</span><br><span class="line"></span><br><span class="line">if (setsockopt(c-&gt;fd, IPPROTO_TCP, TCP_NODELAY,</span><br><span class="line">                                 </span><br><span class="line">(const void *) &amp;tcp_nodelay, sizeof(int)) == -1)</span><br><span class="line">                                 </span><br><span class="line">&#123;</span><br><span class="line">                                     </span><br><span class="line">&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;</span><br><span class="line">                                   </span><br><span class="line">&#125;</span><br><span class="line">                                   </span><br><span class="line">else &#123;</span><br><span class="line">  </span><br><span class="line">//如果设置成功，则设置nodelay为NGX_TCP_NODELAY_UNSET.这样下次就不会进入nodelay的处理。</span><br><span class="line">                                       </span><br><span class="line">c-&gt;tcp_nodelay = NGX_TCP_NODELAY_UNSET;</span><br><span class="line"></span><br><span class="line">ngx_log_debug0(NGX_LOG_DEBUG_HTTP, c-&gt;log, 0,</span><br><span class="line">                                     </span><br><span class="line">&quot;no tcp_nodelay&quot;);</span><br><span class="line">                                   </span><br><span class="line">&#125;</span><br><span class="line">                           </span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">//如果tcp_nodelay没有设置，则进入tcp_nopush的处理。</span><br><span class="line">           </span><br><span class="line">if (c-&gt;tcp_nodelay == NGX_TCP_NODELAY_UNSET) &#123;</span><br><span class="line">  </span><br><span class="line">//设置tcp_nopush(tcp_cork)</span><br><span class="line">                  </span><br><span class="line">if (ngx_tcp_nopush(c-&gt;fd) == NGX_ERROR) &#123;</span><br><span class="line">                      </span><br><span class="line">err = ngx_errno;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">                       </span><br><span class="line">* there is a tiny chance to be interrupted, however,</span><br><span class="line">                       </span><br><span class="line">* we continue a processing without the TCP_CORK</span><br><span class="line">                       </span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">if (err != NGX_EINTR) &#123;</span><br><span class="line">                          </span><br><span class="line">wev-&gt;error = 1;</span><br><span class="line">                          </span><br><span class="line">ngx_connection_error(c, err,</span><br><span class="line">                                               </span><br><span class="line">ngx_tcp_nopush_n &quot; failed&quot;);</span><br><span class="line">                          </span><br><span class="line">return NGX_CHAIN_ERROR;</span><br><span class="line">                      </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">  </span><br><span class="line">//如果设置成功，则将c-&gt;tcp_nopush设置为set，这样当再次需要调用sendfile的时候，就跳过设置tcp_nopush的部分</span><br><span class="line">                      </span><br><span class="line">c-&gt;tcp_nopush = NGX_TCP_NOPUSH_SET;</span><br><span class="line"></span><br><span class="line">ngx_log_debug0(NGX_LOG_DEBUG_EVENT, c-&gt;log, 0,</span><br><span class="line">                                     </span><br><span class="line">&quot;tcp_nopush&quot;);</span><br><span class="line">                  </span><br><span class="line">&#125;</span><br><span class="line">              </span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;&amp;#8230;..</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面我们看到nginx最终会调用sendfile发送数据，然后当前的请求结束，最终会调用tcp_close或者tcp_shutdown(设置linger_timeout)来关闭连接，而当关闭连接的同时，内核会将写buf中缓存的数据发送出去，这样，就不需要我们关闭tcp_cork,因为内核会帮我们做这个，于是减少了一次系统调用。</p>
<p>到了这里，会有一个问题，那就是keepalive的情况，这时就会有问题了，因为keepalive是不会关闭连接的，这样，就需要我们显示的调用tcp_push来将数据push出去。接下来我就来分析上篇介绍keepalive的文章中没有涉及到的部分。</p>
<p>接下来的代码就在ngx_http_set_keepalive中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">//如果tcp_nopush为NGX_TCP_NOPUSH_SET，则说明我们需要关闭tcp_cork,也就是将数据push出去.</span><br><span class="line">      </span><br><span class="line">if (c-&gt;tcp_nopush == NGX_TCP_NOPUSH_SET) &#123;</span><br><span class="line">  </span><br><span class="line">//push数据</span><br><span class="line">          </span><br><span class="line">if (ngx_tcp_push(c-&gt;fd) == -1) &#123;</span><br><span class="line">              </span><br><span class="line">ngx_connection_error(c, ngx_socket_errno, ngx_tcp_push_n &quot; failed&quot;);</span><br><span class="line">              </span><br><span class="line">ngx_http_close_connection(c);</span><br><span class="line">              </span><br><span class="line">return;</span><br><span class="line">          </span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">//reset tcp_nopush</span><br><span class="line">          </span><br><span class="line">c-&gt;tcp_nopush = NGX_TCP_NOPUSH_UNSET;</span><br><span class="line">          </span><br><span class="line">tcp_nodelay = ngx_tcp_nodelay_and_tcp_nopush ? 1 : 0;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">          </span><br><span class="line">tcp_nodelay = 1;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//如果tcp_nodelay存在，则说明我们并没有使用tcp_nopush，此时如果clcf-&gt;tcp_nodelay被设置，则此时需要重新设置tcp_nodelay,也就是关闭nagle算法。</span><br><span class="line">      </span><br><span class="line">if (tcp_nodelay</span><br><span class="line">          </span><br><span class="line">&amp;&amp; clcf-&gt;tcp_nodelay</span><br><span class="line">          </span><br><span class="line">&amp;&amp; c-&gt;tcp_nodelay == NGX_TCP_NODELAY_UNSET)</span><br><span class="line">      </span><br><span class="line">&#123;</span><br><span class="line">          </span><br><span class="line">ngx_log_debug0(NGX_LOG_DEBUG_HTTP, c-&gt;log, 0, &quot;tcp_nodelay&quot;);</span><br><span class="line"></span><br><span class="line">if (setsockopt(c-&gt;fd, IPPROTO_TCP, TCP_NODELAY,</span><br><span class="line">                         </span><br><span class="line">(const void *) &amp;tcp_nodelay, sizeof(int))</span><br><span class="line">              </span><br><span class="line">== -1)</span><br><span class="line">          </span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">#if (NGX_SOLARIS)</span><br><span class="line">              </span><br><span class="line">/\* Solaris returns EINVAL if a socket has been shut down \*/</span><br><span class="line">              </span><br><span class="line">c-&gt;log_error = NGX_ERROR_IGNORE_EINVAL;</span><br><span class="line">  </span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">ngx_connection_error(c, ngx_socket_errno,</span><br><span class="line">                                   </span><br><span class="line">&quot;setsockopt(TCP_NODELAY) failed&quot;);</span><br><span class="line"></span><br><span class="line">c-&gt;log_error = NGX_ERROR_INFO;</span><br><span class="line">              </span><br><span class="line">ngx_http_close_connection(c);</span><br><span class="line">              </span><br><span class="line">return;</span><br><span class="line">          </span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">//reset tcp_nodelay</span><br><span class="line">          </span><br><span class="line">c-&gt;tcp_nodelay = NGX_TCP_NODELAY_SET;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/nginx/">nginx</a><a href="/tags/tcp/">tcp</a><a href="/tags/tcp-cork/">tcp_cork</a><a href="/tags/服务器设计/">服务器设计</a></div><div class="post-nav"><a class="pre" href="/2011/03/13/design-and-implementation-of-if-command-in-nginx.html">nginx中if命令的设计和实现</a><a class="next" href="/2011/02/17/nginx's-analysis-of-keeping-alive-and-pipeline-request-processing.html">nginx对keepalive和pipeline请求处理分析</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/SPDY/">SPDY</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/SPDY/协议/">协议</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/erlang/">erlang</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/erlang/源码阅读/">源码阅读</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/">kernel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/mac/">mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/server/">server</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/协议/">协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/源码阅读/">源码阅读</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/lua/">lua</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/lua/源码阅读/">源码阅读</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/server/">server</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/server/源码阅读/">源码阅读</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/协议/">协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/语言规范/">语言规范</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/rocksdb/" style="font-size: 15px;">rocksdb</a> <a href="/tags/lua/" style="font-size: 15px;">lua</a> <a href="/tags/kernel/" style="font-size: 15px;">kernel</a> <a href="/tags/tcp-ip/" style="font-size: 15px;">tcp/ip</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/server/" style="font-size: 15px;">server</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/process/" style="font-size: 15px;">process</a> <a href="/tags/qemu/" style="font-size: 15px;">qemu</a> <a href="/tags/aio/" style="font-size: 15px;">aio</a> <a href="/tags/google/" style="font-size: 15px;">google</a> <a href="/tags/协议/" style="font-size: 15px;">协议</a> <a href="/tags/路由/" style="font-size: 15px;">路由</a> <a href="/tags/tcp/" style="font-size: 15px;">tcp</a> <a href="/tags/TFO/" style="font-size: 15px;">TFO</a> <a href="/tags/rfc/" style="font-size: 15px;">rfc</a> <a href="/tags/c/" style="font-size: 15px;">c</a> <a href="/tags/语言规范/" style="font-size: 15px;">语言规范</a> <a href="/tags/读书笔记/" style="font-size: 15px;">读书笔记</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/spdy/" style="font-size: 15px;">spdy</a> <a href="/tags/kenel/" style="font-size: 15px;">kenel</a> <a href="/tags/opensource/" style="font-size: 15px;">opensource</a> <a href="/tags/InnoDB/" style="font-size: 15px;">InnoDB</a> <a href="/tags/sever/" style="font-size: 15px;">sever</a> <a href="/tags/rfs/" style="font-size: 15px;">rfs</a> <a href="/tags/fs/" style="font-size: 15px;">fs</a> <a href="/tags/cache/" style="font-size: 15px;">cache</a> <a href="/tags/server，mm/" style="font-size: 15px;">server，mm</a> <a href="/tags/web-server/" style="font-size: 15px;">web server</a> <a href="/tags/tcp-cork/" style="font-size: 15px;">tcp_cork</a> <a href="/tags/服务器设计/" style="font-size: 15px;">服务器设计</a> <a href="/tags/congest/" style="font-size: 15px;">congest</a> <a href="/tags/keepalive/" style="font-size: 15px;">keepalive</a> <a href="/tags/pipeline/" style="font-size: 15px;">pipeline</a> <a href="/tags/epoll/" style="font-size: 15px;">epoll</a> <a href="/tags/erlang/" style="font-size: 15px;">erlang</a> <a href="/tags/mochiweb/" style="font-size: 15px;">mochiweb</a> <a href="/tags/network/" style="font-size: 15px;">network</a> <a href="/tags/loadbalance/" style="font-size: 15px;">loadbalance</a> <a href="/tags/glibc/" style="font-size: 15px;">glibc</a> <a href="/tags/systemcall/" style="font-size: 15px;">systemcall</a> <a href="/tags/心情/" style="font-size: 15px;">心情</a> <a href="/tags/gro/" style="font-size: 15px;">gro</a> <a href="/tags/gc/" style="font-size: 15px;">gc</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/17/design-and-implementation-of-linkbuf-in-innodb.html">InnoDB中LinkBuf设计与实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/17/innodb-tablespace-source-code-analysis.html">InnoDB tablespace源码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/19/mysql-rocksdb.-data-reading-(ii).html">MySQL · RocksDB · 数据的读取(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/13/mysql-rocksdb.-data-reading-(i).html">MySQL · RocksDB · 数据的读取(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/mysql-rocksdb-level-compact-analysis.html">MySQL · RocksDB · Level Compact 分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/07/mysql-rocksdb-memtable-flush-analysis.html">MySQL · RocksDB · Memtable flush分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/08/writing-of-mysql.-rocksdb.-memtable.html">MySQL · RocksDB ·  MemTable的写入</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/04/implementation-of-mysql-rocksdb-writing-logic.html">MySQL · RocksDB ·  写入逻辑的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/06/introduction-to-mysql-rocksdb-column-family.html">MySQL · RocksDB · Column Family介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/08/introduction-to-mysql.-rocksdb.-manifest-file.html">MySQL · RocksDB · MANIFEST文件介绍</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">pagefault.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>